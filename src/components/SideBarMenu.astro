---
// Active menu item is determined dynamically via URL in the script below
// Ensure base always ends with slash for proper path joining
const rawBase = import.meta.env.BASE_URL;
const base = rawBase.endsWith('/') ? rawBase : rawBase + '/';
---

<ul class="menu grow shrink menu-md overflow-y-auto" data-base={base}>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="home" href={base}>Home</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="resume" href={`${base}resume/`}>Resume</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="blog" href={`${base}blog/`}>Blog</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="pottery" href={`${base}pottery/`}>Pottery</a></li>
</ul>

<script>
declare global {
  interface Window {
    __menuListenerAttached?: boolean;
  }
}

function updateActiveMenuItem() {
  const activeClass = 'bg-base-300';
  const menu = document.querySelector('.menu');
  const base = menu?.getAttribute('data-base') || '/';

  // Remove active class from all menu items
  document.querySelectorAll('.menu a').forEach(el => {
    el.classList.remove(activeClass);
  });

  // Always determine active item from current URL
  const path = window.location.pathname;
  let activeId = 'home';

  // Check paths with base prefix
  const homeMatch = path === base || path === base + 'index.html' || path === base.slice(0, -1);
  const resumeMatch = path.startsWith(base + 'resume');
  const blogMatch = path.startsWith(base + 'blog');
  const potteryMatch = path.startsWith(base + 'pottery');

  if (homeMatch && !resumeMatch && !blogMatch && !potteryMatch) activeId = 'home';
  else if (resumeMatch) activeId = 'resume';
  else if (blogMatch) activeId = 'blog';
  else if (potteryMatch) activeId = 'pottery';

  const activeItemElem = document.getElementById(activeId);
  if (activeItemElem) activeItemElem.classList.add(activeClass);
}

// Add listener only once - astro:page-load fires on initial load AND view transitions
if (!window.__menuListenerAttached) {
  window.__menuListenerAttached = true;
  document.addEventListener('astro:page-load', updateActiveMenuItem);
}
</script>
